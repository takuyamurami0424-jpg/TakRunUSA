<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TakRunUSA | Takuya Murami</title>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Noto+Sans+JP:wght@400;500;700&family=Press+Start+2P&family=Yuji+Syuku&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Three.js (3D Library) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- Three.js OrbitControls (For interaction) -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    
    <!-- Markdown Parser (for AI response) -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        /* --- üè≥Ô∏è White & Global Theme --- */
        :root {
            --bg-body: #f7f9fc;
            --text-main: #2d3748;
            --text-sub: #718096;
            --accent: #2c5282;        /* Navy */
            --accent-light: #63b3ed;  /* Sky Blue */
            --white: #ffffff;
            --border: #e2e8f0;
            --shadow: 0 10px 30px rgba(44, 82, 130, 0.08);
            --ink: #1a202c;
        }
        
        * { box-sizing: border-box; }
        body {
            font-family: 'Lato', 'Noto Sans JP', sans-serif;
            margin: 0; padding: 0;
            color: var(--text-main);
            background-color: var(--bg-body);
            line-height: 1.8;
            overflow-x: hidden;
        }
        
        h1, h2, h3 { margin: 0; font-weight: 700; }
        a { text-decoration: none; color: inherit; transition: 0.3s; }

        /* --- Header --- */
        header {
            background: rgba(255,255,255,0.85);
            backdrop-filter: blur(10px);
            padding: 1rem 5%;
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 1000;
            border-bottom: 1px solid var(--border);
        }
        .logo { font-size: 1.4rem; font-weight: 700; color: var(--accent); letter-spacing: 0.05em; }
        .logo span { color: var(--text-sub); font-weight: 400; font-size: 1rem; }
        nav ul { display: flex; gap: 30px; list-style: none; margin: 0; padding: 0; }
        .nav-link { font-size: 0.95rem; color: var(--text-sub); font-weight: 500; }
        .nav-link:hover { color: var(--accent); }

        /* --- üåç 3D Hero Section --- */
        .hero {
            position: relative;
            min-height: 90vh;
            display: flex;
            align-items: center;
            overflow: hidden;
            background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
            cursor: grab; /* „Éâ„É©„ÉÉ„Ç∞„Åß„Åç„Çã„Åì„Å®„ÇíÁ§∫„Åô„Ç´„Éº„ÇΩ„É´ */
        }
        .hero:active { cursor: grabbing; }

        /* 3D Canvas Container */
        #canvas-container {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1;
            opacity: 0.6; /* Â∞ë„ÅóËñÑ„Åè„Åó„Å¶ÊñáÂ≠ó„ÇíË¶ã„ÇÑ„Åô„Åè */
        }
        
        .hero-content {
            position: relative;
            z-index: 2; /* 3D„Çà„ÇäÊâãÂâç„Å´ */
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 5%;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 50px;
            align-items: center;
            pointer-events: none; /* 3DÊìç‰Ωú„ÅÆ„Åü„ÇÅ„Å´„ÇØ„É™„ÉÉ„ÇØ„ÇíÈÄèÈÅé„Åï„Åõ„Çã */
        }
        /* „Ç§„É≥„Çø„É©„ÇØ„ÉÜ„Ç£„Éñ„Å™Ë¶ÅÁ¥†„ÅØ„ÇØ„É™„ÉÉ„ÇØÂèØËÉΩ„Å´Êàª„Åô */
        .hero-text, .profile-wrapper { pointer-events: auto; }

        .kanji-name {
            font-family: 'Yuji Syuku', serif;
            font-size: 3.5rem;
            color: var(--ink);
            line-height: 1.2;
            margin-bottom: 10px;
        }
        .hero-text h1 {
            font-size: 1.2rem; text-transform: uppercase; letter-spacing: 0.2em;
            color: var(--accent); margin-bottom: 20px;
        }
        .hero-text p {
            color: var(--text-sub); max-width: 500px; margin-bottom: 40px;
            background: rgba(255,255,255,0.6); /* ÊñáÂ≠ó„ÅåË™≠„ÇÅ„Çã„Çà„ÅÜ„Å´ËÉåÊôØ */
            padding: 10px; border-radius: 8px;
            backdrop-filter: blur(5px);
        }

        .profile-img {
            width: 100%; max-width: 350px;
            border-radius: 20px;
            box-shadow: 20px 20px 0px rgba(44, 82, 130, 0.2);
            display: block; margin: 0 auto;
        }

        /* Buttons */
        .btn {
            padding: 12px 35px; border-radius: 50px; font-weight: 600;
            display: inline-flex; align-items: center; gap: 10px; cursor: pointer;
        }
        .btn-primary { background: var(--accent); color: #fff; box-shadow: 0 4px 15px rgba(44,82,130,0.3); }
        .btn-primary:hover { transform: translateY(-2px); background: #1a365d; }
        .btn-outline { background: #fff; color: var(--accent); border: 1px solid var(--accent); margin-left: 15px; }
        .btn-outline:hover { background: var(--accent); color: #fff; }

        /* --- üèÉ Game Section --- */
        #game-section {
            padding: 80px 5%; background: #fff; text-align: center;
            border-top: 1px solid var(--border);
        }
        .game-title {
            font-family: 'Press Start 2P', cursive;
            color: var(--accent); font-size: 1.5rem; margin-bottom: 10px;
        }
        .game-ui-container {
            position: relative; max-width: 750px; margin: 0 auto;
            background: #f7fafc; border: 2px solid var(--accent);
            border-radius: 12px; overflow: hidden;
            box-shadow: var(--shadow);
        }
        canvas { display: block; width: 100%; height: 320px; image-rendering: pixelated; }

        /* Game UI Overlay */
        .game-hud {
            position: absolute; top: 10px; left: 10px; right: 10px;
            display: flex; justify-content: space-between; align-items: flex-start;
            z-index: 20; font-family: 'Press Start 2P', cursive; font-size: 0.8rem;
        }
        .hud-box {
            background: rgba(0,0,0,0.6); color: #fff;
            padding: 8px 12px; border-radius: 4px; border: 2px solid #fff;
        }
        
        /* Power Bar */
        .power-bar-container {
            width: 150px; height: 15px; background: #333; border: 2px solid #fff;
            margin-top: 5px; position: relative;
        }
        .power-bar-fill {
            height: 100%; background: #48bb78; width: 100%; transition: width 0.1s;
        }
        .power-label { font-size: 0.6rem; color: #fff; margin-bottom: 2px; display: block; text-align: left; }

        /* Warning Message */
        .game-message {
            position: absolute;
            top: 60px; left: 0; width: 100%;
            text-align: center;
            font-family: 'Press Start 2P', cursive;
            font-size: 0.9rem;
            z-index: 25;
            text-shadow: 2px 2px 0 #fff, -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff;
            pointer-events: none;
        }

        .game-overlay {
            position: absolute; top:0; left:0; width:100%; height:100%;
            background: rgba(255,255,255,0.9);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 30;
        }
        .hidden { display: none !important; }
        .game-btn {
            background: var(--accent); color: #fff; border: none;
            padding: 15px 30px; font-family: 'Press Start 2P', cursive;
            font-size: 0.9rem; cursor: pointer; border-radius: 5px; margin-top: 20px;
        }
        .game-btn:hover { background: #1a365d; }

        /* --- Sections (Exp & Works) --- */
        section { padding: 100px 5%; max-width: 1200px; margin: 0 auto; }
        .section-header { text-align: center; margin-bottom: 60px; }
        .section-title { font-size: 2.2rem; color: var(--text-main); margin-bottom: 10px; }
        .section-subtitle { color: var(--accent); font-weight: 700; letter-spacing: 0.1em; text-transform: uppercase; font-size: 0.9rem; }

        .exp-grid, .works-container {
            display: grid; gap: 30px;
        }
        .exp-grid { grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); }
        .works-container { grid-template-columns: repeat(2, 1fr); }

        .card {
            background: #fff; padding: 40px; border-radius: 12px;
            box-shadow: var(--shadow); border: 1px solid #f0f0f0; transition: 0.3s;
        }
        .card:hover { transform: translateY(-5px); }

        .exp-year { color: var(--accent); font-weight: 700; display: block; margin-bottom: 5px; }
        .exp-title { font-size: 1.3rem; margin-bottom: 5px; }
        .exp-list { padding-left: 20px; font-size: 0.95rem; }

        .note-highlight {
            grid-column: span 2; background: #fff; padding: 50px;
            border-left: 5px solid #2cb696; display: flex; justify-content: space-between; align-items: center;
        }
        .btn-note { background: #2cb696; color: #fff; padding: 10px 25px; border-radius: 50px; font-weight: 600; }

        /* --- ‚ú® AI Assistant Section --- */
        #ai-assistant {
            background: linear-gradient(135deg, #fff 0%, #f0f4f8 100%);
            border-radius: 20px;
            box-shadow: var(--shadow);
            padding: 60px 40px;
            margin-top: 80px;
            border: 1px solid #fff;
        }
        .ai-container {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }
        .ai-input-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        .ai-input {
            flex: 1;
            padding: 15px 25px;
            border-radius: 50px;
            border: 2px solid #e2e8f0;
            font-size: 1rem;
            outline: none;
            transition: 0.3s;
        }
        .ai-input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(44,82,130,0.1); }
        .btn-ai {
            background: linear-gradient(135deg, #2c5282 0%, #4299e1 100%);
            color: #fff;
            padding: 15px 35px;
            border-radius: 50px;
            font-weight: 700;
            cursor: pointer;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 5px 15px rgba(66, 153, 225, 0.3);
            transition: 0.3s;
        }
        .btn-ai:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(66, 153, 225, 0.4); }
        .btn-ai:disabled { opacity: 0.7; cursor: not-allowed; }
        
        .ai-response-box {
            margin-top: 30px;
            background: #fff;
            border-radius: 15px;
            padding: 30px;
            text-align: left;
            min-height: 100px;
            display: none; /* Hidden by default */
            border: 1px solid #e2e8f0;
            position: relative;
        }
        .ai-response-box::before {
            content: 'AI Takuya';
            position: absolute;
            top: -12px; left: 20px;
            background: var(--accent);
            color: #fff;
            font-size: 0.75rem;
            padding: 2px 10px;
            border-radius: 10px;
            font-weight: 700;
        }
        .loading-spinner {
            display: inline-block;
            width: 20px; height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Footer */
        .social-icons { display: flex; justify-content: center; gap: 20px; margin: 40px 0; }
        .social-link {
            width: 50px; height: 50px; border-radius: 50%; background: #fff; color: var(--accent);
            display: flex; align-items: center; justify-content: center; border: 1px solid var(--border);
            font-size: 1.2rem; transition: 0.3s;
        }
        .social-link:hover { background: var(--accent); color: #fff; transform: translateY(-3px); }
        footer { text-align: center; padding: 40px; color: var(--text-sub); border-top: 1px solid var(--border); font-size: 0.9rem; }

        @media (max-width: 768px) {
            .hero-content { grid-template-columns: 1fr; text-align: center; }
            .works-container { grid-template-columns: 1fr; }
            .note-highlight { flex-direction: column; text-align: center; gap: 20px; }
            canvas { height: 250px; }
            .ai-input-group { flex-direction: column; }
            .btn-ai { width: 100%; justify-content: center; }
        }
    </style>
</head>
<body>

    <header>
        <a href="#" class="logo">TakRun<span>USA</span></a>
        <nav>
            <ul>
                <li><a href="#about" class="nav-link">About</a></li>
                <li><a href="#game-section" class="nav-link">Game</a></li>
                <li><a href="#ai-assistant" class="nav-link" style="color:var(--accent);">AI Chat</a></li>
            </ul>
        </nav>
    </header>

    <!-- üåç HERO SECTION with 3D Earth -->
    <div class="hero" id="about">
        <!-- 3D Canvas Background -->
        <div id="canvas-container"></div>

        <div class="hero-content">
            <div class="hero-text">
                <div class="kanji-name">ÊùëË¶ã ÊãìÂìâ</div>
                <h1>Takuya Murami</h1>
                <p>
                    Supply Chain Manager / Marathon Runner<br>
                    Global operations with Kaizen philosophy.<br>
                    Based in Georgia, USA.
                </p>
                <div>
                    <a href="#works" class="btn btn-primary">View Works</a>
                    <a href="https://note.com/tak0424" target="_blank" class="btn btn-outline">
                        <i class="fa-solid fa-pen-nib"></i> Note
                    </a>
                </div>
            </div>
            
            <div>
                <img src="Me.JPG" alt="Takuya Murami" class="profile-img">
            </div>
        </div>
    </div>

    <!-- üèÉ MARATHON GAME SECTION -->
    <div id="game-section">
        <h2 class="game-title">Full Marathon Challenge</h2>
        <p style="color: #718096; margin-bottom: 30px;">
            Goal: 42.195km. <br>Grab üíßWater to recover Stamina.<br> Beware the "Wall" at 30km!
        </p>
        
        <div class="game-ui-container">
            <div class="game-hud">
                <div class="hud-box" style="text-align: left;">
                    <span class="power-label">STAMINA</span>
                    <div class="power-bar-container">
                        <div class="power-bar-fill" id="staminaBar"></div>
                    </div>
                </div>
                <div class="hud-box">
                    DIST: <span id="distDisplay">0.000</span> km
                </div>
            </div>

            <!-- New Alert Message Area -->
            <div id="gameMessage" class="game-message hidden"></div>

            <canvas id="gameCanvas" width="800" height="320"></canvas>
            
            <!-- Start Screen -->
            <div id="startScreen" class="game-overlay">
                <h3 style="color: var(--accent); margin-bottom: 10px;">Ready for 42.195km?</h3>
                <p style="font-size: 0.8rem; color: #555;">[SPACE] or [TAP] to Jump</p>
                <button class="game-btn" onclick="startGame()">START RACE</button>
            </div>
            
            <!-- Game Over Screen -->
            <div id="gameOverScreen" class="game-overlay hidden">
                <h3 id="resultTitle" style="color: var(--accent); margin-bottom: 10px;">Race Finished!</h3>
                <p style="color: #333;">Result: <span id="finalDist">0.000</span> km</p>
                <button class="game-btn" onclick="startGame()">TRY AGAIN</button>
            </div>
        </div>
    </div>

    <!-- ‚ú® AI ASSISTANT SECTION (GEMINI API) -->
    <section id="ai-assistant">
        <div class="ai-container">
            <div class="section-header" style="margin-bottom: 30px;">
                <span class="section-subtitle">AI ADVISOR</span>
                <h2 class="section-title">Ask AI Takuya</h2>
                <p style="color: var(--text-sub);">
                    „Çµ„Éó„É©„Ç§„ÉÅ„Çß„Éº„É≥„ÅÆÂ∞ÇÈñÄÁî®Ë™û„ÇÑ„ÄÅ„Éû„É©„ÇΩ„É≥„Éà„É¨„Éº„Éã„É≥„Ç∞„ÅÆÊÇ©„Åø„Å™„Å©„ÄÅ<br>
                    Takuya„ÅÆAIÂàÜË∫´„Åå„ÅäÁ≠î„Åà„Åó„Åæ„Åô„ÄÇ
                </p>
            </div>

            <div class="ai-input-group">
                <input type="text" id="userQuery" class="ai-input" placeholder="‰æã: Kaizen„Å®„ÅØ‰Ωï„Åß„Åô„ÅãÔºü / „Éï„É´„Éû„É©„ÇΩ„É≥„ÅÆ„Ç≥„ÉÑ„ÅØÔºü">
                <button onclick="askGemini()" class="btn-ai" id="askBtn">
                    ‚ú® Ask AI
                </button>
            </div>

            <div id="aiResponse" class="ai-response-box">
                <!-- Response will appear here -->
            </div>
        </div>
    </section>

    <!-- Experience -->
    <section id="experience">
        <div class="section-header">
            <span class="section-subtitle">Career Path</span>
            <h2 class="section-title">Professional Experience</h2>
        </div>
        <div class="exp-grid">
            <div class="card">
                <span class="exp-year">2019 - Present</span>
                <h3 class="exp-title">Logistics and Sales Operation</h3>
                <p style="color:#718096;">Sakai America Inc | GA, USA</p>
                <ul class="exp-list">
                    <li>Achieved $630K in freight cost savings (18% reduction).</li>
                    <li>Designed Excel-based quoting tool.</li>
                    <li>Developed inventory visibility tools.</li>
                </ul>
            </div>
            <div class="card">
                <span class="exp-year">2017 - 2018</span>
                <h3 class="exp-title">SCM Advisor</h3>
                <p style="color:#718096;">Nisshinbo Automotive | GA, USA</p>
                <ul class="exp-list">
                    <li>Realized $500K in supplier cost reductions.</li>
                    <li>Reduced inventory costs by $100K annually.</li>
                </ul>
            </div>
            <div class="card">
                <span class="exp-year">2006 - 2017</span>
                <h3 class="exp-title">Purchasing Manager</h3>
                <p style="color:#718096;">Nisshinbo Brake Inc | Japan</p>
                <ul class="exp-list">
                    <li>Global centralized purchasing.</li>
                    <li>Maintained 98% on-time delivery rate.</li>
                </ul>
            </div>
        </div>
    </section>

    <!-- Works -->
    <section id="works">
        <div class="section-header">
            <span class="section-subtitle">Output</span>
            <h2 class="section-title">Latest Activities</h2>
        </div>
        <div class="works-container">
            <div class="card note-highlight">
                <div>
                    <h3 style="font-size:1.5rem;">Official Note Blog</h3>
                    <p style="color:#718096; margin-top:5px;">Supply Chain, US Life & Running.</p>
                </div>
                <a href="https://note.com/tak0424" target="_blank" class="btn-note">Read</a>
            </div>
            <div class="card">
                <span style="color:var(--accent); font-weight:700; font-size:0.8rem;">PROJECT</span>
                <h3>Quotation Tool</h3>
                <p style="color:#718096;">Excel-based tool to reduce user errors.</p>
            </div>
            <div class="card">
                <span style="color:var(--accent); font-weight:700; font-size:0.8rem;">LIFESTYLE</span>
                <h3>Running Logs</h3>
                <p style="color:#718096;">Documenting marathons across the US.</p>
            </div>
        </div>
    </section>

    <!-- Contact -->
    <div style="background:#f7fafc; padding:80px 5%; text-align:center; border-top:1px solid #e2e8f0;">
        <h2 class="section-title">Connect With Me</h2>
        <div class="social-icons">
            <a href="https://note.com/tak0424" target="_blank" class="social-link"><i class="fa-solid fa-pen-nib"></i></a>
            <a href="https://x.com/Murami10" target="_blank" class="social-link"><i class="fa-brands fa-x-twitter"></i></a>
            <a href="https://www.facebook.com/takuya.murami.1" target="_blank" class="social-link"><i class="fa-brands fa-facebook-f"></i></a>
            <a href="https://www.youtube.com/@takuyamurami6423" target="_blank" class="social-link"><i class="fa-brands fa-youtube"></i></a>
        </div>
    </div>

    <footer>
        &copy; 2026 TakRunUSA | Takuya Murami. All Rights Reserved.
    </footer>

    <!-- üåç THREE.JS (3D Earth) SCRIPT -->
    <script>
        // Init Scene
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        // Camera
        const camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
        camera.position.z = 18; // Ë∑ùÈõ¢Ë™øÊï¥

        // Renderer
        const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
        renderer.setSize(container.clientWidth, container.clientHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        container.appendChild(renderer.domElement);

        // OrbitControls
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true; // ÊÖ£ÊÄß„Çí„Å§„Åë„Çã
        controls.dampingFactor = 0.05;
        controls.enableZoom = false;   // „Éö„Éº„Ç∏„Çπ„ÇØ„É≠„Éº„É´„Å®Âπ≤Ê∏â„Åó„Å™„ÅÑ„Çà„ÅÜ„Å´„Ç∫„Éº„É†„ÅØÁÑ°ÂäπÂåñ
        controls.enablePan = false;    // Âπ≥Ë°åÁßªÂãï„ÇÇÁÑ°ÂäπÂåñ
        controls.autoRotate = true;    // „Ç´„É°„É©Ëá™‰Ωì„ÇÇ„ÇÜ„Å£„Åè„ÇäÂõû„Åô
        controls.autoRotateSpeed = 1.0;

        // --- Create Particle Globe (Wireframe-ish look) ---
        const geometry = new THREE.SphereGeometry(10, 32, 32);
        
        // Material: Dots (Supply Chain Nodes style)
        const pointsMaterial = new THREE.PointsMaterial({
            color: 0x2c5282, // Navy
            size: 0.15,
            transparent: true,
            opacity: 0.8
        });
        const globePoints = new THREE.Points(geometry, pointsMaterial);
        scene.add(globePoints);

        // Material: Wireframe (Network connection style)
        const lineMaterial = new THREE.MeshBasicMaterial({
            color: 0x63b3ed, // Light Blue
            wireframe: true,
            transparent: true,
            opacity: 0.1
        });
        const globeLines = new THREE.Mesh(geometry, lineMaterial);
        scene.add(globeLines);

        // Animation Loop
        function animateGlobe() {
            requestAnimationFrame(animateGlobe);
            
            // Ëá™Ëª¢Ôºà„É°„ÉÉ„Ç∑„É•Ëá™‰Ωì„ÅÆÂõûËª¢Ôºâ
            globePoints.rotation.y += 0.001;
            globeLines.rotation.y += 0.001;
            globePoints.rotation.x += 0.0005;

            controls.update(); // Update controls

            renderer.render(scene, camera);
        }
        animateGlobe();

        // Resize Handle
        window.addEventListener('resize', () => {
            const width = container.clientWidth;
            const height = container.clientHeight;
            renderer.setSize(width, height);
            camera.aspect = width / height;
            camera.updateProjectionMatrix();
        });
    </script>

    <!-- üèÉ MARATHON GAME SCRIPT -->
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        ctx.imageSmoothingEnabled = false;

        // UI Elements
        const startScreen = document.getElementById('startScreen');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const distDisplay = document.getElementById('distDisplay');
        const finalDist = document.getElementById('finalDist');
        const staminaBar = document.getElementById('staminaBar');
        const resultTitle = document.getElementById('resultTitle');
        const gameMessage = document.getElementById('gameMessage');

        // Game State
        let isRunning = false;
        let distance = 0.0; // km
        let stamina = 100;
        let speed = 0; // pixel speed
        let frame = 0;
        let baseSpeed = 10; // Speed Up!! (was 8)

        // Player
        const player = { x: 50, y: 240, w: 40, h: 40, dy: 0, jump: -12, g: 0.6, grounded: false };
        // Items & Obstacles
        let objects = []; // { type: 'water' | 'cone', x, y, w, h }

        // Constants
        const GOAL_DIST = 42.195;
        const WALL_DIST = 30.0;
        const ALERT_DIST = 25.0; // Alert starts here
        const COLORS = { sky: '#ebf8ff', road: '#718096', grass: '#68d391' };

        function drawRect(x, y, w, h, c) { ctx.fillStyle = c; ctx.fillRect(Math.floor(x), Math.floor(y), w, h); }

        function drawPlayer(p) {
            // Simple Runner Sprite
            const baseY = p.y;
            drawRect(p.x+10, baseY, 15, 12, '#f6e05e'); // Head (Blonde/Hat)
            drawRect(p.x+5, baseY+12, 25, 18, '#2c5282'); // Shirt
            // Legs
            if(p.grounded) {
                if (Math.floor(frame/10)%2===0) {
                    drawRect(p.x+5, baseY+30, 8, 10, '#1a202c');
                    drawRect(p.x+22, baseY+30, 8, 10, '#1a202c');
                } else {
                    drawRect(p.x+10, baseY+28, 8, 8, '#1a202c');
                    drawRect(p.x+18, baseY+28, 8, 8, '#1a202c');
                }
            } else {
                drawRect(p.x+5, baseY+28, 8, 10, '#1a202c'); // Jump leg
            }
        }

        function drawWater(o) {
            // Blue Cup
            drawRect(o.x, o.y+10, 15, 20, '#4299e1');
            drawRect(o.x+2, o.y+8, 11, 2, '#fff'); // Rim
            ctx.fillStyle='#2b6cb0'; ctx.font='8px Arial'; ctx.fillText('H2O', o.x, o.y+22);
        }

        function drawCone(o) {
            // Orange Triangle
            ctx.fillStyle = '#ed8936';
            ctx.beginPath();
            ctx.moveTo(o.x + 10, o.y);
            ctx.lineTo(o.x + 20, o.y + 30);
            ctx.lineTo(o.x, o.y + 30);
            ctx.fill();
        }

        function startGame() {
            isRunning = true;
            distance = 0.0;
            stamina = 100;
            speed = baseSpeed;
            objects = [];
            player.y = 240; player.dy = 0;
            startScreen.classList.add('hidden');
            gameOverScreen.classList.add('hidden');
            gameMessage.classList.add('hidden');
            update();
        }

        function update() {
            if (!isRunning) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // --- 1. Background ---
            // Sky
            let grad = ctx.createLinearGradient(0,0,0,320);
            grad.addColorStop(0, COLORS.sky); grad.addColorStop(1, '#fff');
            ctx.fillStyle = grad; ctx.fillRect(0,0,canvas.width, 320);
            
            // Road & Grass
            drawRect(0, 240, canvas.width, 80, COLORS.road);
            drawRect(0, 230, canvas.width, 10, COLORS.grass);

            // --- 2. Game Logic ---
            // Stamina Decay
            let decay = 0.05;
            // The "Wall" at 30km Logic
            if (distance >= WALL_DIST) {
                decay = 0.15; // Triple decay
                if (stamina < 30) {
                    speed = baseSpeed * 0.5; // Slow down
                    // Alert Message: Slow Down
                    gameMessage.innerText = "‚ö†Ô∏è 30km„ÅÆÂ£ÅÔºÅ„Éö„Éº„Çπ„ÉÄ„Ç¶„É≥...";
                    gameMessage.style.color = "#e53e3e"; // Red
                    gameMessage.classList.remove('hidden');
                } else {
                    speed = baseSpeed;
                    gameMessage.classList.add('hidden'); // Hide if recovered
                }
            } else if (distance >= ALERT_DIST) {
                // Alert Message: Warning
                speed = baseSpeed;
                gameMessage.innerText = "‚ö†Ô∏è 30km„ÅÆÂ£Å„ÅåÊé•Ëøë‰∏≠...";
                gameMessage.style.color = "#d69e2e"; // Yellow
                gameMessage.classList.remove('hidden');
            } else {
                speed = baseSpeed;
                gameMessage.classList.add('hidden');
            }

            stamina -= decay;
            if (stamina < 0) stamina = 0;

            // Distance Update
            // Multiplier doubled for much faster game flow (0.001 -> 0.002)
            distance += (speed * 0.002);
            
            // UI Update
            distDisplay.innerText = distance.toFixed(3);
            staminaBar.style.width = stamina + '%';
            if(stamina < 20) staminaBar.style.background = '#e53e3e'; // Red
            else if(stamina < 50) staminaBar.style.background = '#ecc94b'; // Yellow
            else staminaBar.style.background = '#48bb78'; // Green

            // Goal Check
            if (distance >= GOAL_DIST) {
                endGame(true);
                return;
            }
            // Game Over Check (Stamina 0)
            if (stamina <= 0) {
                // Keep running very slow or stop? Let's stop.
                endGame(false);
                return;
            }

            // --- 3. Objects Spawning ---
            // Spawn rate adjusted for higher speed (80 -> 60)
            if (frame % 60 === 0) {
                // Chance to spawn Water (Help) or Cone (Obstacle)
                // More water after 30km?
                let r = Math.random();
                if (r > 0.6) {
                    objects.push({ type: 'water', x: canvas.width, y: 210, w: 20, h: 30 });
                } else {
                    // objects.push({ type: 'cone', x: canvas.width, y: 210, w: 20, h: 30 });
                    // *User requested just Power Up mechanics mainly, but obstacles add fun. Let's stick to Water for now to match "Drinking water increases power"*
                     objects.push({ type: 'water', x: canvas.width, y: 210, w: 20, h: 30 });
                }
            }

            // --- 4. Physics & Drawing ---
            player.dy += player.g;
            player.y += player.dy;
            if (player.y > 240) { player.y = 240; player.dy = 0; player.grounded = true; }
            
            drawPlayer(player);

            // Objects Loop
            for (let i = 0; i < objects.length; i++) {
                let o = objects[i];
                o.x -= speed;
                
                if (o.type === 'water') drawWater(o);
                else drawCone(o);

                // Collision
                if (
                    player.x < o.x + o.w &&
                    player.x + player.w > o.x &&
                    player.y < o.y + o.h &&
                    player.y + player.h > o.y
                ) {
                    if (o.type === 'water') {
                        stamina += 15; // Power Up!
                        if (stamina > 100) stamina = 100;
                        objects.splice(i, 1);
                        i--;
                    }
                }
                // Cleanup
                if (o.x < -50) { objects.splice(i, 1); i--; }
            }

            frame++;
            requestAnimationFrame(update);
        }

        function endGame(isGoal) {
            isRunning = false;
            finalDist.innerText = distance.toFixed(3);
            if (isGoal) {
                resultTitle.innerText = "GOAL!! Full Marathon Complete!";
                resultTitle.style.color = "#48bb78";
                distDisplay.innerText = "42.195";
            } else {
                resultTitle.innerText = "Retired... (Out of Stamina)";
                resultTitle.style.color = "#e53e3e";
            }
            gameOverScreen.classList.remove('hidden');
        }

        // Input
        function jump() {
            if (player.grounded) {
                player.dy = player.jump;
                player.grounded = false;
            }
        }
        document.addEventListener('keydown', (e) => { if(e.code==='Space'){ e.preventDefault(); if(isRunning) jump(); else startGame(); } });
        canvas.addEventListener('touchstart', (e) => { e.preventDefault(); if(isRunning) jump(); else startGame(); });
        canvas.addEventListener('mousedown', (e) => { if(isRunning) jump(); else startGame(); });

    </script>

    <!-- ‚ú® GEMINI API SCRIPT -->
    <script>
        const apiKey = ""; // API Key injected by environment

        async function askGemini() {
            const query = document.getElementById('userQuery').value;
            const responseBox = document.getElementById('aiResponse');
            const askBtn = document.getElementById('askBtn');

            if (!query) return;

            // UI Loading State
            askBtn.disabled = true;
            askBtn.innerHTML = '<span class="loading-spinner"></span> Thinking...';
            responseBox.style.display = 'block';
            responseBox.innerHTML = 'Thinking...';

            const systemPrompt = `
                „ÅÇ„Å™„Åü„ÅØTakuya Murami„Åß„Åô„ÄÇ„Ç∏„Éß„Éº„Ç∏„Ç¢Â∑ûÂú®‰Ωè„ÅÆ„Çµ„Éó„É©„Ç§„ÉÅ„Çß„Éº„É≥„Éû„Éç„Éº„Ç∏„É£„Éº„Åß„ÅÇ„Çä„ÄÅ„Éû„É©„ÇΩ„É≥„É©„É≥„Éä„Éº„Åß„Åô„ÄÇ
                ‰ª•‰∏ã„ÅÆ„Éà„Éî„ÉÉ„ÇØ„Å´„Å§„ÅÑ„Å¶„ÄÅ„Éó„É≠„Éï„Çß„ÉÉ„Ç∑„Éß„Éä„É´„Åã„Å§Ë¶™„Åó„Åø„ÇÑ„Åô„ÅÑ„Éà„Éº„É≥„ÅßÊó•Êú¨Ë™û„ÅßÂõûÁ≠î„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºö
                1. „Çµ„Éó„É©„Ç§„ÉÅ„Çß„Éº„É≥„ÄÅ„É≠„Ç∏„Çπ„ÉÜ„Ç£„ÇØ„Çπ„ÄÅKaizen„ÄÅË™øÈÅî„Å´„Å§„ÅÑ„Å¶„ÄÇ
                2. „Éû„É©„ÇΩ„É≥„ÅÆ„Éà„É¨„Éº„Éã„É≥„Ç∞„ÄÅÊåÅ‰πÖÂäõ„ÄÅ30km„ÅÆÂ£Å„ÅÆ‰πó„ÇäË∂ä„ÅàÊñπ„Å´„Å§„ÅÑ„Å¶„ÄÇ
                3. „Ç¢„É°„É™„Ç´„Åß„ÅÆÁîüÊ¥ª„Å´„Å§„ÅÑ„Å¶„ÄÇ
                
                ÂõûÁ≠î„ÅØÁ∞°ÊΩî„Å´„ÄÅË¶ÅÁÇπ„Çí„Åæ„Å®„ÇÅ„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ„Éû„Éº„ÇØ„ÉÄ„Ç¶„É≥ÂΩ¢Âºè„ÅßÂá∫Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
            `;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{ text: query }]
                        }],
                        systemInstruction: {
                            parts: [{ text: systemPrompt }]
                        }
                    })
                });

                const data = await response.json();
                
                if (data.candidates && data.candidates[0].content) {
                    const answer = data.candidates[0].content.parts[0].text;
                    // Parse Markdown
                    responseBox.innerHTML = marked.parse(answer);
                } else {
                    responseBox.innerHTML = "„Åô„Åø„Åæ„Åõ„Çì„ÄÅ‰ªä„Å°„Çá„Å£„Å®ËÄÉ„Åà„Åå„Åæ„Å®„Åæ„Çä„Åæ„Åõ„Çì„ÄÇ„ÇÇ„ÅÜ‰∏ÄÂ∫¶ËÅû„ÅÑ„Å¶„Åø„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ";
                }

            } catch (error) {
                console.error('Error:', error);
                responseBox.innerHTML = "„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØÊé•Á∂ö„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ";
            } finally {
                askBtn.disabled = false;
                askBtn.innerHTML = '‚ú® Ask AI';
            }
        }
        
        // Allow Enter key to submit
        document.getElementById('userQuery').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                askGemini();
            }
        });
    </script>

</body>
</html>
